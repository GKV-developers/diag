### Cray Fortran Compiler ###
FC = ftn 
FFLAGS = -O3 -hfp3 -eF # Optimization
FFLAGS += -homp    # OpenMP
FFLAGS += -rm      # Optimization report
#FFLAGS += -dynamic -hpic -Wl,--no-relax# Static Memory larger than 2GB
FFLAGS += -s integer64# Change default integer type as integer(kind=8).
#FFLAGS = -craype-verbose -h display_opt
FFLAGS += -g -R b -K trap=fp # Debug
OPTRPT = 'lst'


#### Intel Fortran Compiler ###
#FC = ftn 
#FFLAGS = -O3 -Ofast -fp-model fast=2 -ipo -fpp # Optimization
#FFLAGS += -qopenmp                        # OpenMP
#FFLAGS += -qopt-report=3                  # Optimization report
#FFLAGS += -dynamic -fpic -mcmodel=medium -shared-intel # Static Memory larger than 2GB
##FFLAGS += -g # Debug
#OPTRPT = 'optrpt'

### Usage of FFTW (module load cray-fftw)
INC += -I${FFTW_INC}
LIB += -L${FFTW_DIR} -lfftw3 -lm
### Usage of NetCDF (module load cray-hdf5-parallel/1.10.5.1 cray-netcdf-hdf5parallel/4.6.3.1)
INC += -I$(NETCDF_DIR)/include -I$(HDF5_DIR)/include
LIB += -L$(NETCDF_DIR)/lib -L$(HDF5_DIR)/lib -lnetcdff -lnetcdf -lhdf5_hl -lhdf5


### Read Fortran binary GKV output
FILEIO = diag_rb_fortran
### Read NetCDF GKV output
#FILEIO = diag_rb_netcdf


SRC = ./src
PROG = diag.exe

diag:	${SRC}/diag_header.f90\
	${SRC}/diag_functions.f90\
	${SRC}/diag_clock.f90\
	${SRC}/gkvp_igs.f90\
	${SRC}/gkvp_vmecbzx.f90\
	${SRC}/diag_geom.f90\
	${SRC}/diag_intgrl.f90\
	${SRC}/diag_parity.f90\
	${SRC}/${FILEIO}.f90\
	${SRC}/diag_fft.f90\
	${SRC}/out_textfile.f90\
	${SRC}/out_netcdf.f90\
	${SRC}/out_mominxy.f90\
	${SRC}/out_mominxz.f90\
	${SRC}/out_mominkxky.f90\
	${SRC}/out_trninkxky.f90\
	${SRC}/out_triinkxky.f90\
	${SRC}/out_mominz.f90\
	${SRC}/out_momintky.f90\
	${SRC}/out_mominavs.f90\
	${SRC}/out_mominxmf.f90\
	${SRC}/out_mominvtk.f90\
	${SRC}/out_mominrz.f90\
	${SRC}/out_ffinkxky.f90\
	${SRC}/out_ffinvm.f90\
	${SRC}/out_ffinzv.f90\
	${SRC}/out_ffinzvm_vtk.f90\
	${SRC}/out_mominfreq.f90\
	${SRC}/out_linfreq.f90\
	${SRC}/out_correlate.f90\
	${SRC}/out_realsp.f90\
	${SRC}/out_bicoherence.f90\
	${SRC}/out_zfshearing.f90\
	${SRC}/out_zfdensity.f90\
	${SRC}/out_fluidtotaltrans.f90\
	${SRC}/out_fluidsubsptrans.f90\
	${SRC}/out_fluiddetailtrans.f90\
	${SRC}/diag_chgres_util.f90\
	${SRC}/diag_chgres_cnt.f90\
	${SRC}/diag_main.f90

	${FC} ${FFLAGS} -c ${SRC}/diag_header.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_functions.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_clock.f90
	${FC} ${FFLAGS} -c ${SRC}/gkvp_igs.f90
	${FC} ${FFLAGS} -c ${SRC}/gkvp_vmecbzx.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_geom.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_intgrl.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_parity.f90
	${FC} ${FFLAGS} -c ${SRC}/${FILEIO}.f90 ${INC}
	${FC} ${FFLAGS} -c ${SRC}/diag_fft.f90 ${INC}
	${FC} ${FFLAGS} -c ${SRC}/out_textfile.f90
	${FC} ${FFLAGS} -c ${SRC}/out_netcdf.f90 ${INC}
	${FC} ${FFLAGS} -c ${SRC}/out_mominxy.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_mominxz.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominkxky.f90
	${FC} ${FFLAGS} -c ${SRC}/out_trninkxky.f90
	${FC} ${FFLAGS} -c ${SRC}/out_triinkxky.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominz.f90
	${FC} ${FFLAGS} -c ${SRC}/out_momintky.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_mominavs.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominxmf.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominvtk.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominrz.f90
	${FC} ${FFLAGS} -c ${SRC}/out_ffinkxky.f90
	${FC} ${FFLAGS} -c ${SRC}/out_ffinvm.f90
	${FC} ${FFLAGS} -c ${SRC}/out_ffinzv.f90
	${FC} ${FFLAGS} -c ${SRC}/out_ffinzvm_vtk.f90
	${FC} ${FFLAGS} -c ${SRC}/out_mominfreq.f90
	${FC} ${FFLAGS} -c ${SRC}/out_linfreq.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_correlate.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_realsp.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_bicoherence.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_zfshearing.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_zfdensity.f90
	${FC} ${FFLAGS} -c ${SRC}/out_fluidtotaltrans.f90
#	${FC} ${FFLAGS} -c ${SRC}/out_fluidsubsptrans.f90
	${FC} ${FFLAGS} -c ${SRC}/out_fluiddetailtrans.f90
	${FC} ${FFLAGS} -c ${SRC}/diag_chgres_util.f90 ${INC}
	${FC} ${FFLAGS} -c ${SRC}/diag_chgres_cnt.f90 ${INC}
	${FC} ${FFLAGS} -c ${SRC}/diag_main.f90

	${FC} ${FFLAGS} *.o -o ${PROG} ${LIB}

	rm -f *.o *.mod *.${OPTRPT}

clean:
	rm -f *.o *.mod *.${OPTRPT} *.exe *.out *.err
